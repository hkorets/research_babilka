---
title: "Research project"
output: html_notebook
---

```{r}
library(tidyverse)
library(ggplot2)
library(dplyr) 
```

## Data Cleaning

```{r}
movies <- read.csv("movies.csv")
```

```{r}
#clear all null values for better analysis
movies <- movies %>% filter(gross_income != 0)
movies <- movies %>% filter(directors_name != "nm0000000")
movies <- movies %>% filter(rating != 11.0)
#String tags to integers
movies <- movies %>%
  mutate(certificate = case_when(
    certificate %in% c("G", "TV-G", "TV-Y", "E", "K-A", "Passed", "Approved") ~ 1,
    certificate %in% c("6+") ~ 6,
    certificate %in% c("12", "PG-12") ~ 12,
    certificate %in% c("PG-13", "TV-13", "MA-13", "M/PG", "M") ~ 13,
    certificate %in% c("R", "TV-MA", "MA-17", "R-15", "T") ~ 17,
    certificate %in% c("NC-17", "R-18", "18", "AO") ~ 18,
    certificate %in% c("PG", "TV-PG", "GP") ~ 1,
    TRUE ~ 0
  ))
movies <- movies %>%
  mutate(
    gross_income = gsub(",", "", gross_income), # Видаляємо коми
    gross_income = as.numeric(gross_income)    # Перетворюємо на числовий формат
  )
movies <- movies %>%
  mutate(
    votes = gsub(",", "", votes),
    votes = as.numeric(votes)
  )

movies <- movies %>%
  mutate(duration = as.integer(gsub("[^0-9]", "", duration)))
head(movies)

```

## Hypothesis test

### 1. Movies in popular genres tend to have higher gross income.

In this analysis, we are testing the relationship between a movie's genre and its gross income.

#### Null Hypothesis (H₀):

There is **no relationship** between a movie's genre and its gross income.\
**H₀**: The mean gross income is the same across all genres.

#### Alternative Hypothesis (H₁):

Movies in **popular genres** tend to have higher gross income compared to those in less popular genres.\
**H₁**: The mean gross income differs across genres.

To test this hypothesis we use **ANOVA test**.

### Key Concepts of ANOVA (Analysis of Variance)

In summary, ANOVA compares the **variance** within groups and between groups to assess whether there are significant differences in the means. The key steps are:

1.  **Calculate** the total, between-group, and within-group sums of squares. $$
    \text{SST}, \text{SSB}, \text{SSW}
    $$

2.  **Compute** the mean squares by dividing the sums of squares by their respective degrees of freedom. $$
    \text{MSB} = \frac{\text{SSB}}{\text{dfB}}, \quad \text{MSW} = \frac{\text{SSW}}{\text{dfW}}
    $$

3.  **Determine** the F-statistic by comparing the mean square between groups to the mean square within groups. $$
    F = \frac{\text{MSB}}{\text{MSW}}
    $$

4.  **Evaluate** the p-value to decide whether to reject the null hypothesis.

### R Implementation

```{r}
movies_data_separated <- movies %>%
  # Split genres by commas and gather them into separate rows
  separate_rows(genre, sep = ",") %>%
  # Trim any leading/trailing spaces
  mutate(genre = str_trim(genre))

# Step 2: Perform One-way ANOVA
anova_result <- aov(gross_income ~ genre, data = movies_data_separated)

# Summarize the ANOVA result
summary(anova_result)

# Step 3: Visualize the gross income distribution across genres
ggplot(movies_data_separated, aes(x = genre, y = gross_income)) +
  geom_boxplot() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(title = "Gross Income Distribution Across Genres",
       x = "Genre",
       y = "Gross Income")
```

### Test conclusion

-   **F-value**: A value of **3.763** means that the variation between genres is about 3.763 times larger than the variation within genres.
-   **P-value**: The p-value is **1.9e-08**, which is **very small**, meaning the result is statistically significant. This tells us that the genre **does indeed affect gross income**.
-   **Plot**: Plot generated based on data also prove that gross income vary between genres.

```{r}
genre_means <- movies_data_separated %>%
  group_by(genre) %>%                   # Group by genre
  summarise(mean_gross_income = mean(gross_income, na.rm = TRUE)) %>%  # Calculate mean gross income for each genre
  arrange(desc(mean_gross_income))      # Sort genres by mean gross income in descending order

# View the results
genre_means
```

Here we might see what movies genres have most gross income. The most grossing genre is the western, the least - game shows.

### 2. Movies directed by a specific director are significantly higher than the the average rating of all movies.

Here we will try to find out whether director has impact on rating of movies

#### Null Hypothesis ($H_{0}$):

The mean ratings of movies directed by a specific director (e.g., Christopher Nolan) are equal to the population mean.

#### Alternative Hypothesis ($H_{1}$):

The mean ratings of movies directed by the specific director are significantly higher than the population mean.

For this hypothesis we will use *t-test*

### Key Concepts of t-test

A t-test is a statistical test used to compare the means of two groups or a sample mean with a known population mean to determine if there is a significant difference between them. The key steps are:

1.  For each director, calculate the average rating and average gross income of their movies to choose the top director.

2.  Calculate the mean rating of the selected director’s movies.

3.  Calculate the mean rating of all movies in the population.

4.  Use the one-sample t-test formula to calculate the t-statistic: $t = \frac{\bar{x} - \mu}{s / \sqrt{n}}$

5.  Evaluate the p-value to decide whether to reject the null hypothesis.

### R Implementation

```{r}
# Separate the directors by commas and create separate lines for each
movies_separated <- movies %>%
  separate_rows(directors_name, sep = ",") %>%
  mutate(directors_name = str_trim(directors_name))  # Remove unnecessary spaces

# Now we can continue with the analysis for each director
top_directors <- movies_separated %>%
  group_by(directors_name) %>%
  summarize(
    avg_rating = mean(rating, na.rm = TRUE),
    avg_gross_income = mean(gross_income, na.rm = TRUE)
  ) %>%
  filter(
    avg_rating >= quantile(movies_separated$rating, 0.9, na.rm = TRUE) &
    avg_gross_income >= quantile(movies_separated$gross_income, 0.9, na.rm = TRUE)
  ) %>%
  arrange(desc(avg_rating), desc(avg_gross_income))

print(top_directors)
```

```{r}
director <- head(top_directors$directors_name, 1)

director_movies <- movies %>%
  filter(directors_name == director)

mean_director_rating <- mean(director_movies$rating, na.rm = TRUE)
mean_population_rating <- mean(movies$rating, na.rm = TRUE)

t_test_result <- t.test(director_movies$rating, mu = mean_population_rating, alternative = "greater")

director
t_test_result  

ratings_data <- data.frame(
  Category = c("Population Mean", "Director's Mean"),
  Mean_Rating = c(mean_population_rating, mean_director_rating)
)

# Plot the bar chart
bar_plot <- ggplot(ratings_data, aes(x = Category, y = Mean_Rating, fill = Category)) +
  geom_bar(stat = "identity", width = 0.5) +
  geom_hline(yintercept = mean_population_rating, linetype = "dashed", color = "red", linewidth = 0.8, alpha = 0.7) +
  labs(
    title = paste("Comparison of Ratings: ", director),
    x = "Category",
    y = "Mean Rating"
  ) +
  theme_minimal() +
  scale_fill_manual(values = c("lightgreen", "salmon")) +
  theme(legend.position = "none")

print(bar_plot)
```

### Test conclusion

The p-value ($0.01948$) is less than the typical significance level ( $\alpha = 0.05$). This means we reject the null hypothesis ($H_{0}$) and accept the alternative hypothesis ($H_{1}$).

There is sufficient evidence to conclude that the mean rating of movies directed by the specific director is significantly higher than the population mean rating at a 95% confidence level.

### 3. How gross income changes from year to year

We are examining whether the gross income of movies is significantly influenced by the year of release.

#### Null Hypothesis ($H_{0}$):

The gross income of movies does not change significantly with the year of release.

#### Alternative Hypothesis ($H_{1}$):

The gross income of movies changes significantly with the year of release.

Here we use **ANOVA test**, because it is appropriate since it tests the differences in the means of a continuous variable (gross income) across multiple groups (genres or years).

### Key Concepts of ANOVA (Analysis of Variance)

1.  **Between-Groups Variation (SSB):**\
    Measures how the mean gross income differs between years. A large SSB indicates a significant difference in gross income between years.

2.  **Within-Groups Variation (SSW):**\
    Measures the variability of gross income within each year. A small SSW suggests that movies within the same year have similar gross incomes.

3.  **Total Variation (SST):**\
    The total variation in gross income across all movies. The relationship is: $SST = SSB + SSW$

4.  **Mean Square Between Groups (MSB):**\
    $MSB = \frac{SSB}{df_B}, \quad df_B = k - 1$ where k is the number of years.

5.  **Mean Square Within Groups (MSW):**\
    $MSW = \frac{SSW}{df_W}, \quad df_W = n - k$ where n is the total number of movies.

6.  **F-Statistic:**\
    $F = \frac{MSB}{MSW}$ The F-statistic compares the variation between groups (years) to the variation within groups (movies in the same year).

7.  Using the F-statistic and the degrees of freedom, determine the **p-value** from the F-distribution.

### R Implementation

```{r}

# Ensure 'year' is treated as a categorical variable
movies$year <- as.factor(movies$year)

# Perform ANOVA
anova_result <- aov(gross_income ~ year, data = movies)

# Summary of ANOVA
summary(anova_result)


#visualization of gross income distribution across years
ggplot(movies, aes(x = year, y = gross_income)) +
  geom_boxplot() +
  labs(title = "Gross Income Across Years", x = "Year", y = "Gross Income") +
  theme_minimal()


```

### Test conclusion

The p-value associated with the “year” factor is \< 2e-16, which is extremely small (much smaller than the typical significance level of 0.05). This means that the gross income of movies does change significantly over the years, so we reject the null hypothesis.
